var G=DateX=z();module.exports={DateX,$D:G,DateXFactory:z};function z(){let c=K(i),p={get:(s,o)=>s[o]?m(s,o):c[o]?.(s),set:(s,o,f)=>c[o]?c[o](s,f):s[o],ownKeys:s=>Object.getOwnPropertyNames(c),has:(s,o)=>o in c||o in s};function l({name:s,fn:o,isMethod:f=!1,proxifyResult:r=!1}={}){if(!s||!o||!(o instanceof Function))return console.error("es-date-fiddler (extendWith): cannot extend without name and/or fn (function)");c[s]=a=>(a=i(a),a.localeInfo&&a.relocate(a.localeInfo),f?(...d)=>r?i(o(a,...d)):o(a,...d):r?i(o(a)):o(a))}function h(){return D()}function g({locale:s,timeZone:o}={}){return D().localeValidator({locale:s,timeZone:o})}function i(s){return new Proxy(s,p)}function m(s,o){return o in s&&s[o]instanceof Function?s[o].bind(s):s[o]}function D(s,o){let f=s?.locale||s?.timeZone,r=(s||"")instanceof Date,a=f?new Date:new Date(r?s:Date.parse(s)),d=isNaN(a)?new Date(Date.now()):a,S=i(d);return(f||o)&&(S.locale=f?s:o),S}return Object.defineProperties(D,{now:{get(){return h()}},extendWith:{get(){return l}},validateLocale:{get(){return g}}}),D}function K(c){let p=!0,l=B(),h=e=>!(isNaN(parseInt(e))&&isNaN(+e)),g=e=>e?.constructor===Object,i=e=>+e.slice(e.indexOf("+")+1).replace(":","")||0,m=e=>e.localeInfo?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone,D=(e,t=2)=>`${e}`.padStart(t,"0"),s=e=>e.map(t=>String(t)?.padStart(2,"0")??t),o=e=>s(T(e)).join("-"),f=e=>Object.entries(e).filter(([,t])=>h(t)),r=(e,t)=>{let n={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds(),milliseconds:e.getMilliseconds()};return t?Object.values(n):n},a=e=>{let t={timeZone:m(e),hourCycle:"h23"},n;try{return c(new Date(new Date(e.toLocaleString("en",t))))}catch(u){return console.error(`Can't retrieve localized date/time value for ${t.timeZone}: ${u.message}`),c(e)}},d=e=>console.error(`clone${e?"Time":"Date"}To: no toDate given`),S=(e,t)=>{t=c(t??new Date);let n=c(e);if(t){let[u,$,N]=n.date;return t.date={year:u,month:$,date:N},n.locale&&(t.locale={locale:n.locale.locale,timeZone:n.locale.timeZone}),t}return d(),n},y=(e,t)=>{t=c(t??new Date);let n=c(e),{hour:u,minutes:$,seconds:N,ms:Z}=n;return t.time={hour:u,minutes:$,seconds:N,ms:Z},n.locale?(t.locale={locale:n.locale.locale,timeZone:n.locale.timeZone},t):(d(1),n)},O=e=>{e=c(e);let t={};if(!e.locale)return e.toLocaleString();let{locale:n,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleString(n,t)},I=(e,...t)=>{e=c(e);let n,u,$;return e.locale&&(n=e.locale.locale,u=e.locale.timeZone,$=e.formats),t.length===1?l(e,t[0],$):t.length?l(e,...t):e.toLocaleString(n||[],u?{timeZone:u}:void 0)},M=(e,t)=>g(t)&&f(t).forEach(([n,u])=>e[`set${n}`](u))&&!0||!1,b=e=>[e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()??0],T=e=>[e.getFullYear(),e.getMonth()+1,e.getDate()],L=(e,t)=>M(e,t)||b(e),A=(e,t)=>M(e,t)||T(e),W=J(),w=(e,t)=>c(new Date(e,t+1,1,0,0,0)).yesterday.getDate(),V=e=>[e.getFullYear(),e.getMonth(),e.getDate()],P=e=>c(new Date(e)).relocate(e.localeInfo),x=Q(),F=(e,...t)=>c(x(e,...t)),H=e=>console.error(`invalid locale (time zone: "${e.timeZone}", locale: "${e.locale}"), associated your locale instead`),Y=(e,t,n=!0)=>{try{return Intl.DateTimeFormat(e,{timeZone:t}).resolvedOptions()}catch{return n&&H({locale:e,timeZone:t}),Intl.DateTimeFormat().resolvedOptions()}},E=(e,t)=>[`${e&&!(Array.isArray(e)&&e.length<1)?`l:${e}`:""}`,`${t?`tz:${t}`:""}`].filter(n=>n).join(","),U=function(e,{locale:t,timeZone:n}={}){if(t||n){let u=Y(t||[],n);e.localeInfo={locale:u?.locale||navigator?.language||"en",timeZone:u?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone},e.formats=E(e.localeInfo.locale,e.localeInfo.timeZone)}return e.localeInfo??void 0},j=(e,{locale:t,timeZone:n,validate:u=!0}={})=>((t||n)&&(e.localeInfo=U(e,{locale:t,timeZone:n,validate:u})),e.localeInfo),X=e=>(delete e.localeInfo,c(e)),k=function(e,t,n,u){return(t||n)&&j(e,{locale:t,timeZone:n}),c(e)},C=function(e,t){return e=c(e),e.format(t?"MM":"WD",`l:${e.locale?.locale||"utc"}`)},_=e=>{let t={};if(e=c(e),!e.locale)return e.toLocaleDateString();let{locale:n,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleDateString(n,t)},q=(e,t)=>{let n=b(e).reduce((u,$,N)=>[...u,N<3?D($):D($,3)],[]);return`${n.slice(0,3).join(":")}${t?`.${n.slice(-1)}`:""}`};return{clone:P,localizedDT:a,hasDST:e=>{let t=m(e),n=new Date(e.getFullYear(),0,1,14),u=new Date(new Date(n).setMonth(6)),$=Intl.DateTimeFormat("en-CA",{year:"numeric",timeZone:t,timeZoneName:"shortOffset"}),[N,Z]=[$.format(n),$.format(u)];return i(N)-i(Z)!==0},getTimezone:m,dateStr:_,localeValidator:()=>({locale:e,timeZone:t}={})=>{if(!e&&!t)return!1;let n=Y(e,t,!1);return e&&!t?n.locale===e:(t&&!e||n.locale===e)&&t===n.timeZone},year:(e,t)=>t&&e.setFullYear(t)||e.getFullYear(),month:(e,t)=>t&&e.setMonth(v-1)||e.getMonth()+1,date:(e,{year:t,month:n,date:u}={})=>A(e,{FullYear:t,Month:h(n)?n-1:n,Date:u}),hour:(e,t)=>t&&e.setHours(t)||e.getHours(),minutes:(e,t)=>t&&e.setMinutes(t)||e.getMinutes(),seconds:(e,t)=>t&&e.setSeconds(t)||e.getSeconds(),cloneTimeTo:e=>t=>y(e,t),cloneDateTo:e=>t=>S(e,t),time:(e,{hour:t,minutes:n,seconds:u,milliseconds:$}={})=>L(e,{Hours:t,Minutes:n,Seconds:u,Milliseconds:$}),timeStr:e=>(t=!1)=>q(e,t),dateISOStr:e=>o(e),ms:(e,t)=>t&&e.setMilliseconds(t)||e.getMilliseconds(),monthName:e=>C(e,!0),weekDay:e=>C(e),self:e=>e,local:e=>O(e),locale:(e,{locale:t,timeZone:n}={})=>j(e,{locale:t,timeZone:n}),removeLocale:e=>()=>X(e),relocate:e=>({locale:t,timeZone:n}={})=>k(e,t,n),differenceFrom:e=>t=>W({start:e,end:t}),values:e=>t=>r(e,t),ISO:e=>e.toISOString(),daysInMonth:e=>w(e.getFullYear(),e.getMonth()),isLeapYear:e=>w(e.getFullYear(),1)===29,format:e=>(...t)=>I(e,...t),addYears:e=>(t=1)=>F(e,`${t} years`),addMonths:e=>(t=1)=>F(e,`${t} months`),addWeeks:e=>(t=1)=>F(e,`${t*7} days`),addDays:e=>(t=1)=>F(e,`${t} days`),nextYear:e=>F(e,"1 year"),nextWeek:e=>F(e,"7 days"),previousWeek:e=>F(e,"subtract, 7 days"),previousYear:e=>F(e,"subtract, 1 year"),nextMonth:e=>F(e,"1 month"),previousMonth:e=>F(e,"subtract, 1 month"),tomorrow:e=>F(e,"1 day"),yesterday:e=>F(e,"subtract, 1 day"),add:e=>(...t)=>F(e,...t),subtract:e=>(...t)=>F(e,...["subtract"].concat([t]).flat())}}function B(){let[c,p,l,h]=["2-digit","numeric","long","short"],g={fixed:{MM:{month:l},M:{month:h},m:{month:p},mm:{month:c},yyyy:{year:p},yy:{year:c},WD:{weekday:l},wd:{weekday:h},d:{day:p},dd:{day:c},h:{hour:p},hh:{hour:c},mi:{minute:p},mmi:{minute:c},s:{second:p},ss:{second:c},ms:{fractionalSecondDigits:3},tz:{timeZoneName:"shortOffset"},dl:{locale:"default"},h12:{hour12:!1},yn:{yearName:""},ry:{relatedYear:!0},msp:{fractionalSecond:!0}},dynamic:{tzn:r=>({timeZoneName:r.slice(4)}),hrc:r=>({hourCycle:`h${r.slice(4)}`}),ds:r=>({dateStyle:r.slice(3)}),ts:r=>({timeStyle:r.slice(3)}),tz:r=>({timeZone:r.slice(3)}),e:r=>({era:r.slice(2)}),l:r=>({locale:r.slice(2)})}},i={...g,retrieveDyn(r){let a=r?.slice(0,r.indexOf(":"));return g.dynamic[a]&&g.dynamic[a](r)},get re(){return new RegExp(`\\b(${Object.keys(g.fixed).join("|")})\\b`,"g")}},m=(r="dtf",a=0)=>{let d=` ${r.replace(/(?<=\{)(.+?)(?=})/g,y=>`[${a++}]`).replace(/[{}]/g,"").trim()} `,S=r.match(/(?<=\{)(.+?)(?=})/g)||[];return{get texts(){return S},formatString(y){d=y},set formatStr(y){d=y},get formatStr(){return d},get units(){return d.match(i.re)||[]},finalize(y="",O="",I="",M=""){return d.replace(/~([\d+]?)/g,"$1").replace(/dtf/,y).replace(/era/,I).replace(/dp\b|~dp\b/,O).replace(/yn\b/,M).replace(/\[(\d+?)]/g,(b,T)=>S[T].trim()).trim()}}},D=r=>r.replace(/\s+/g,""),s=(...r)=>r?.reduce((a,d)=>({...a,...i.retrieveDyn(d)||i.fixed[d]}),i.fixed.dl),o=(r,a,d)=>{let S=s(...D(d).split(",")),y=Intl.DateTimeFormat(S.locale,S).format(r);return a.finalize(y)},f=(r,a,d)=>{let S=s(...a.units.concat(D(d).split(",")).flat()),y={...i.fixed},O=(M,b)=>S[M]==="numeric"&&b.startsWith("0")?b.slice(1):b,I=Intl.DateTimeFormat(S.locale,S).formatToParts(r).reduce((M,b)=>b.type==="literal"?M:{...M,[b.type]:O(b.type,b.value)},{});return y.ms=S.fractionalSecondDigits?y.msp:y.ms,y.yyyy=I.relatedYear?y.ry:y.yyyy,a.formatStr=a.formatStr.replace(i.re,M=>I[Object.keys(y[M]).shift()]||M),a.finalize(void 0,I.dayPeriod,I.era,I.yearName)};return(r,a,d="l:default")=>/ds:|ts:/.test(d)?o(r,m(void 0),d):f(r,m(a||void 0),d)}function J(){let c=(h,g)=>{let i=isNaN(h),m=isNaN(g);if(i&&!m){let[D,s,o]=Array(3).fill("start- and/or end date are not valid");return{error:!0,message:D,full:s,clean:o}}if(m){let[D,s,o]=Array(3).fill("end date not valid");return{error:!0,message:D,full:s,clean:o}}if(i){let[D,s,o]=Array(3).fill("start date not valid");return{error:!0,message:D,full:s,clean:o}}return{error:!1}},p=l();return function({start:g,end:i}={}){let m=new Date(Date.parse(g)),D=new Date(Date.parse(i)),s=c(m,D);if(s.error)return s;let o=new Date(g),f=new Date(i),r=Math.abs(f-o),a=new Date(r),d=a.getUTCFullYear()-1970,S=a.getUTCMonth(),y=a.getUTCDate()-1,O=a.getUTCHours(),I=a.getUTCMinutes(),M=a.getUTCSeconds(),b=a.getUTCMilliseconds(),T={from:o,to:f,years:d,months:S,days:y,hours:O,minutes:I,seconds:M,milliseconds:b};return T.full=p({values:T,full:!0}),T.clean=p({values:T}),T};function l(){let h=(...o)=>f=>o.reduce((r,a)=>a(r),f),g=(o,f)=>o===1?f.slice(0,-1):f;return h(({values:o,full:f})=>[Object.entries(o).filter(([r])=>/^(years|month|days|hours|minutes|seconds)/i.test(r)),f],([o,f])=>f?o:o.filter(([,r])=>f?+r:r>0),o=>o.reduce((f,[r,a])=>[...f,`${a} ${g(a,r)}`],[]),o=>o.length<1?"Dates are equal":`${o.slice(0,-1).join(", ")}${o.length>1?" and ":""}${o.slice(-1).shift()}`)}}function Q(){let c=Object.entries({year:"FullYear",month:"Month",date:"Date",day:"Date",hour:"Hours",minute:"Minutes",second:"Seconds",millisecond:"Milliseconds"}).reduce((l,[h,g])=>({...l,[h]:g,[`${h}s`]:g}),{}),p=function(...l){if(l.length<1)return[];let h;l[0].startsWith("subtract")&&(h=!0,l[0].startsWith("subtract")&&l.length===1&&(l=l[0].split(",")),l=l.slice(1));let g=l.length===1?l[0]?.split(/,/):l;return g&&g.length&&(l=g.map(i=>i.trim())),l.map(function(i){return i.toLowerCase().split(/\s/).map(m=>(m=m.trim(),parseInt(m)?h?-m:+m:m))})};return function(l,...h){let g=p(...h);return g.length&&g.forEach(([i,m])=>{m=c[m],+i&&m&&l[`set${m}`](l[`get${m}`]()+ +i)}),l}}
