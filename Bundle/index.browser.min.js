window.$D=window.DateX=C();window.DateXFactory=C;function C(){let a=Object.freeze(G(i)),p={get:(s,o)=>s[o]?f(s,o):a[o]?.(s),set:(s,o,m)=>a[o]?a[o](s,m):s[o],ownKeys:s=>Object.getOwnPropertyNames(a),has:(s,o)=>o in a||o in s};function l({name:s,fn:o,isMethod:m=!1,proxifyResult:r=!1}={}){if(!s||!o||!(o instanceof Function))return console.error("es-date-fiddler (extendWith): cannot extend without name and/or fn (function)");a=Object.freeze({...a,[s]:c=>(c=i(c),c.localeInfo&&c.relocate(c.localeInfo),m?(...d)=>r?i(o(c,...d)):o(c,...d):r?i(o(c)):o(c))}),console.log(`\u2714 created '${s}' ${m?"method":"getter"}`)}function h(){return D()}function g({locale:s,timeZone:o}={}){return D().localeValidator({locale:s,timeZone:o})}function i(s){return new Proxy(s,p)}function f(s,o){return o in s&&s[o]instanceof Function?s[o].bind(s):s[o]}function D(s,o){let m=s?.locale||s?.timeZone,r=(s||"")instanceof Date,c=m?new Date:new Date(r?s:Date.parse(s)),d=isNaN(c)?new Date(Date.now()):c,S=i(d);return(m||o)&&(S.locale=m?s:o),S}return Object.defineProperties(D,{now:{get(){return h()}},extendWith:{get(){return l}},validateLocale:{get(){return g}}}),D}function G(a){let p=!0,l=K(),h=e=>!(isNaN(parseInt(e))&&isNaN(+e)),g=e=>e?.constructor===Object,i=e=>+e.slice(e.indexOf("+")+1).replace(":","")||0,f=e=>e.localeInfo?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone,D=(e,t=2)=>`${e}`.padStart(t,"0"),s=e=>e.map(t=>String(t)?.padStart(2,"0")??t),o=e=>s(T(e)).join("-"),m=e=>Object.entries(e).filter(([,t])=>h(t)),r=(e,t)=>{let n={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds(),milliseconds:e.getMilliseconds()};return t?Object.values(n):n},c=e=>{let t={timeZone:f(e),hourCycle:"h23"},n;try{return a(new Date(new Date(e.toLocaleString("en",t))))}catch(u){return console.error(`Can't retrieve localized date/time value for ${t.timeZone}: ${u.message}`),a(e)}},d=e=>console.error(`clone${e?"Time":"Date"}To: no toDate given`),S=(e,t)=>{t=a(t??new Date);let n=a(e);if(t){let[u,F,w]=n.date;return t.date={year:u,month:F,date:w},n.locale&&(t.locale={locale:n.locale.locale,timeZone:n.locale.timeZone}),t}return d(),n},y=(e,t)=>{t=a(t??new Date);let n=a(e),{hour:u,minutes:F,seconds:w,ms:N}=n;return t.time={hour:u,minutes:F,seconds:w,ms:N},n.locale?(t.locale={locale:n.locale.locale,timeZone:n.locale.timeZone},t):(d(1),n)},O=e=>{e=a(e);let t={};if(!e.locale)return e.toLocaleString();let{locale:n,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleString(n,t)},I=(e,...t)=>{e=a(e);let n,u,F;return e.locale&&(n=e.locale.locale,u=e.locale.timeZone,F=e.formats),t.length===1?l(e,t[0],F):t.length?l(e,...t):e.toLocaleString(n||[],u?{timeZone:u}:void 0)},M=(e,t)=>g(t)&&m(t).forEach(([n,u])=>e[`set${n}`](u))&&!0||!1,b=e=>[e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()??0],T=e=>[e.getFullYear(),e.getMonth()+1,e.getDate()],L=(e,t)=>M(e,t)||b(e),A=(e,t)=>M(e,t)||T(e),W=B(),Z=(e,t)=>a(new Date(e,t+1,1,0,0,0)).yesterday.getDate(),Q=e=>[e.getFullYear(),e.getMonth(),e.getDate()],P=e=>a(new Date(e)).relocate(e.localeInfo),H=J(),$=(e,...t)=>a(H(e,...t)),x=e=>console.error(`invalid locale (time zone: "${e.timeZone}", locale: "${e.locale}"), associated your locale instead`),j=(e,t,n=!0)=>{try{return Intl.DateTimeFormat(e,{timeZone:t}).resolvedOptions()}catch{return n&&x({locale:e,timeZone:t}),Intl.DateTimeFormat().resolvedOptions()}},E=(e,t)=>[`${e&&!(Array.isArray(e)&&e.length<1)?`l:${e}`:""}`,`${t?`tz:${t}`:""}`].filter(n=>n).join(","),U=function(e,{locale:t,timeZone:n}={}){if(t||n){let u=j(t||[],n);e.localeInfo={locale:u?.locale||navigator?.language||"en",timeZone:u?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone},e.formats=E(e.localeInfo.locale,e.localeInfo.timeZone)}return e.localeInfo??void 0},Y=(e,{locale:t,timeZone:n,validate:u=!0}={})=>((t||n)&&(e.localeInfo=U(e,{locale:t,timeZone:n,validate:u})),e.localeInfo),X=e=>(delete e.localeInfo,a(e)),k=function(e,t,n,u){return(t||n)&&Y(e,{locale:t,timeZone:n}),a(e)},z=function(e,t){return e=a(e),e.format(t?"MM":"WD",`l:${e.locale?.locale||"utc"}`)},_=e=>{let t={};if(e=a(e),!e.locale)return e.toLocaleDateString();let{locale:n,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleDateString(n,t)},q=(e,t)=>{let n=b(e).reduce((u,F,w)=>[...u,w<3?D(F):D(F,3)],[]);return`${n.slice(0,3).join(":")}${t?`.${n.slice(-1)}`:""}`};return{clone:P,localizedDT:c,hasDST:e=>{let t=f(e),n=new Date(e.getFullYear(),0,1,14),u=new Date(new Date(n).setMonth(6)),F=Intl.DateTimeFormat("en-CA",{year:"numeric",timeZone:t,timeZoneName:"shortOffset"}),[w,N]=[F.format(n),F.format(u)];return i(w)-i(N)!==0},getTimezone:f,dateStr:_,localeValidator:()=>({locale:e,timeZone:t}={})=>{if(!e&&!t)return!1;let n=j(e,t,!1);return e&&!t?n.locale===e:(t&&!e||n.locale===e)&&t===n.timeZone},year:(e,t)=>t&&e.setFullYear(t)||e.getFullYear(),month:(e,t)=>t&&e.setMonth(v-1)||e.getMonth()+1,date:(e,{year:t,month:n,date:u}={})=>A(e,{FullYear:t,Month:h(n)?n-1:n,Date:u}),hour:(e,t)=>t&&e.setHours(t)||e.getHours(),minutes:(e,t)=>t&&e.setMinutes(t)||e.getMinutes(),seconds:(e,t)=>t&&e.setSeconds(t)||e.getSeconds(),cloneTimeTo:e=>t=>y(e,t),cloneDateTo:e=>t=>S(e,t),time:(e,{hour:t,minutes:n,seconds:u,milliseconds:F}={})=>L(e,{Hours:t,Minutes:n,Seconds:u,Milliseconds:F}),timeStr:e=>(t=!1)=>q(e,t),dateISOStr:e=>o(e),ms:(e,t)=>t&&e.setMilliseconds(t)||e.getMilliseconds(),monthName:e=>z(e,!0),weekDay:e=>z(e),self:e=>e,local:e=>O(e),locale:(e,{locale:t,timeZone:n}={})=>Y(e,{locale:t,timeZone:n}),removeLocale:e=>()=>X(e),relocate:e=>({locale:t,timeZone:n}={})=>k(e,t,n),differenceFrom:e=>t=>W({start:e,end:t}),values:e=>t=>r(e,t),ISO:e=>e.toISOString(),daysInMonth:e=>Z(e.getFullYear(),e.getMonth()),isLeapYear:e=>Z(e.getFullYear(),1)===29,format:e=>(...t)=>I(e,...t),addYears:e=>(t=1)=>$(e,`${t} years`),addMonths:e=>(t=1)=>$(e,`${t} months`),addWeeks:e=>(t=1)=>$(e,`${t*7} days`),addDays:e=>(t=1)=>$(e,`${t} days`),nextYear:e=>$(e,"1 year"),nextWeek:e=>$(e,"7 days"),previousWeek:e=>$(e,"subtract, 7 days"),previousYear:e=>$(e,"subtract, 1 year"),nextMonth:e=>$(e,"1 month"),previousMonth:e=>$(e,"subtract, 1 month"),tomorrow:e=>$(e,"1 day"),yesterday:e=>$(e,"subtract, 1 day"),add:e=>(...t)=>$(e,...t),subtract:e=>(...t)=>$(e,...["subtract"].concat([t]).flat())}}function K(){let[a,p,l,h]=["2-digit","numeric","long","short"],g={fixed:{MM:{month:l},M:{month:h},m:{month:p},mm:{month:a},yyyy:{year:p},yy:{year:a},WD:{weekday:l},wd:{weekday:h},d:{day:p},dd:{day:a},h:{hour:p},hh:{hour:a},mi:{minute:p},mmi:{minute:a},s:{second:p},ss:{second:a},ms:{fractionalSecondDigits:3},tz:{timeZoneName:"shortOffset"},dl:{locale:"default"},h12:{hour12:!1},yn:{yearName:""},ry:{relatedYear:!0},msp:{fractionalSecond:!0}},dynamic:{tzn:r=>({timeZoneName:r.slice(4)}),hrc:r=>({hourCycle:`h${r.slice(4)}`}),ds:r=>({dateStyle:r.slice(3)}),ts:r=>({timeStyle:r.slice(3)}),tz:r=>({timeZone:r.slice(3)}),e:r=>({era:r.slice(2)}),l:r=>({locale:r.slice(2)})}},i={...g,retrieveDyn(r){let c=r?.slice(0,r.indexOf(":"));return g.dynamic[c]&&g.dynamic[c](r)},get re(){return new RegExp(`\\b(${Object.keys(g.fixed).join("|")})\\b`,"g")}},f=(r="dtf",c=0)=>{let d=` ${r.replace(/(?<=\{)(.+?)(?=})/g,y=>`[${c++}]`).replace(/[{}]/g,"").trim()} `,S=r.match(/(?<=\{)(.+?)(?=})/g)||[];return{get texts(){return S},formatString(y){d=y},set formatStr(y){d=y},get formatStr(){return d},get units(){return d.match(i.re)||[]},finalize(y="",O="",I="",M=""){return d.replace(/~([\d+]?)/g,"$1").replace(/dtf/,y).replace(/era/,I).replace(/dp\b|~dp\b/,O).replace(/yn\b/,M).replace(/\[(\d+?)]/g,(b,T)=>S[T].trim()).trim()}}},D=r=>r.replace(/\s+/g,""),s=(...r)=>r?.reduce((c,d)=>({...c,...i.retrieveDyn(d)||i.fixed[d]}),i.fixed.dl),o=(r,c,d)=>{let S=s(...D(d).split(",")),y=Intl.DateTimeFormat(S.locale,S).format(r);return c.finalize(y)},m=(r,c,d)=>{let S=s(...c.units.concat(D(d).split(",")).flat()),y={...i.fixed},O=(M,b)=>S[M]==="numeric"&&b.startsWith("0")?b.slice(1):b,I=Intl.DateTimeFormat(S.locale,S).formatToParts(r).reduce((M,b)=>b.type==="literal"?M:{...M,[b.type]:O(b.type,b.value)},{});return y.ms=S.fractionalSecondDigits?y.msp:y.ms,y.yyyy=I.relatedYear?y.ry:y.yyyy,c.formatStr=c.formatStr.replace(i.re,M=>I[Object.keys(y[M]).shift()]||M),c.finalize(void 0,I.dayPeriod,I.era,I.yearName)};return(r,c,d="l:default")=>/ds:|ts:/.test(d)?o(r,f(void 0),d):m(r,f(c||void 0),d)}function B(){let a=(h,g)=>{let i=isNaN(h),f=isNaN(g);if(i&&!f){let[D,s,o]=Array(3).fill("start- and/or end date are not valid");return{error:!0,message:D,full:s,clean:o}}if(f){let[D,s,o]=Array(3).fill("end date not valid");return{error:!0,message:D,full:s,clean:o}}if(i){let[D,s,o]=Array(3).fill("start date not valid");return{error:!0,message:D,full:s,clean:o}}return{error:!1}},p=l();return function({start:g,end:i}={}){let f=new Date(Date.parse(g)),D=new Date(Date.parse(i)),s=a(f,D);if(s.error)return s;let o=new Date(g),m=new Date(i),r=Math.abs(m-o),c=new Date(r),d=c.getUTCFullYear()-1970,S=c.getUTCMonth(),y=c.getUTCDate()-1,O=c.getUTCHours(),I=c.getUTCMinutes(),M=c.getUTCSeconds(),b=c.getUTCMilliseconds(),T={from:o,to:m,years:d,months:S,days:y,hours:O,minutes:I,seconds:M,milliseconds:b};return T.full=p({values:T,full:!0}),T.clean=p({values:T}),T};function l(){let h=(...o)=>m=>o.reduce((r,c)=>c(r),m),g=(o,m)=>o===1?m.slice(0,-1):m;return h(({values:o,full:m})=>[Object.entries(o).filter(([r])=>/^(years|month|days|hours|minutes|seconds)/i.test(r)),m],([o,m])=>m?o:o.filter(([,r])=>m?+r:r>0),o=>o.reduce((m,[r,c])=>[...m,`${c} ${g(c,r)}`],[]),o=>o.length<1?"Dates are equal":`${o.slice(0,-1).join(", ")}${o.length>1?" and ":""}${o.slice(-1).shift()}`)}}function J(){let a=Object.entries({year:"FullYear",month:"Month",date:"Date",day:"Date",hour:"Hours",minute:"Minutes",second:"Seconds",millisecond:"Milliseconds"}).reduce((l,[h,g])=>({...l,[h]:g,[`${h}s`]:g}),{}),p=function(...l){if(l.length<1)return[];let h;l[0].startsWith("subtract")&&(h=!0,l[0].startsWith("subtract")&&l.length===1&&(l=l[0].split(",")),l=l.slice(1));let g=l.length===1?l[0]?.split(/,/):l;return g&&g.length&&(l=g.map(i=>i.trim())),l.map(function(i){return i.toLowerCase().split(/\s/).map(f=>(f=f.trim(),parseInt(f)?h?-f:+f:f))})};return function(l,...h){let g=p(...h);return g.length&&g.forEach(([i,f])=>{f=a[f],+i&&f&&l[`set${f}`](l[`get${f}`]()+ +i)}),l}}
