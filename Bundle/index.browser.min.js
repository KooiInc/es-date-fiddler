window.$D=window.DateX=C();window.DateXFactory=C;function C(){let c=Object.freeze(K(l,y)),p={get:(n,r)=>n[r]?S(n,r):c[r]?.(n),set:(n,r,o)=>c[r]?c[r](n,o):n[r],ownKeys:n=>Object.getOwnPropertyNames(c),has:(n,r)=>r in c||r in n};function m({name:n,fn:r,root:o=!1,isMethod:a=!1,proxifyResult:i=!1}={}){if(!n||!r||!(r instanceof Function))return console.error("es-date-fiddler (extendWith): cannot extend without name and/or fn (function)");if(o)return Object.defineProperty(D,n,{value:(...f)=>l(r(...f))}),console.log(`\u2714 created '${n}' root level method`);c=Object.freeze({...c,[n]:f=>(f=l(f),f.localeInfo&&f.relocate(f.localeInfo),a?(...g)=>i?l(r(f,...g)):r(f,...g):i?l(r(f)):r(f))}),console.log(`\u2714 created '${n}' ${a?"method":"getter"}`)}function y(n,r,o=!0){let a=i=>console.error(`invalid locale (time zone: "${i.timeZone}", locale: "${i.locale}"), associated your locale instead`);try{return Intl.DateTimeFormat(n,{timeZone:r}).resolvedOptions()}catch{return o&&a({locale:n,timeZone:r}),Intl.DateTimeFormat().resolvedOptions()}}function d(){return D()}function h({locale:n,timeZone:r}={}){if(!n&&!r)return!1;let o=y(n,r,!1);return n&&!r?o.locale===n:(r&&!n||o.locale===n)&&r===o.timeZone}function l(n){return new Proxy(n,p)}function S(n,r){return r in n&&n[r]instanceof Function?n[r].bind(n):n[r]}function D(n,r){n=Array.isArray(n)?new Date(...n):n;let o=n?.locale||n?.timeZone,a=(n||"")instanceof Date,i=o?new Date:new Date(a?n:Date.parse(n)),f=isNaN(i)?new Date(Date.now()):i,g=l(f);return(o||r)&&(g.locale=o?n:r),g}return Object.defineProperties(D,{now:{get(){return d()}},extendWith:{get(){return m}},validateLocale:{get(){return h}},ownFns:{get(){return Object.getOwnPropertyDescriptors(c)}}}),D}function K(c,p){let m=!0,y=B(),d=e=>!(isNaN(parseInt(e))&&isNaN(+e)),h=e=>e?.constructor===Object,l=e=>+e.slice(e.indexOf("+")+1).replace(":","")||0,S=e=>e.localeInfo?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone,D=(e,t=2)=>`${e}`.padStart(t,"0"),n=e=>e.map(t=>String(t)?.padStart(2,"0")??t),r=e=>n(N(e)).join("-"),o=e=>Object.entries(e).filter(([,t])=>d(t)),a=(e,t=!1)=>{let s=t?0:1,u={year:e.getFullYear(),month:e.getMonth()+s,date:e.getDate(),hour:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds(),milliseconds:e.getMilliseconds()};return{get object(){return u},get array(){return Object.values(u)}}},i=e=>{let t={timeZone:S(e),hourCycle:"h23"},s;try{return c(new Date(new Date(e.toLocaleString("en",t))))}catch(u){return console.error(`Can't retrieve localized date/time value for ${t.timeZone}: ${u.message}`),c(e)}},f=e=>console.error(`clone${e?"Time":"Date"}To: no toDate given`),g=(e,t)=>{t=c(t??new Date);let s=c(e);if(t){let[u,F,O]=s.date;return t.date={year:u,month:F,date:O},s.locale&&(t.locale={locale:s.locale.locale,timeZone:s.locale.timeZone}),t}return f(),s},T=(e,t)=>{t=c(t??new Date);let s=c(e),{hour:u,minutes:F,seconds:O,ms:Z}=s;return t.time={hour:u,minutes:F,seconds:O,ms:Z},s.locale?(t.locale={locale:s.locale.locale,timeZone:s.locale.timeZone},t):(f(1),s)},I=e=>{e=c(e);let t={};if(!e.locale)return e.toLocaleString();let{locale:s,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleString(s,t)},$=(e,...t)=>{e=c(e);let s,u,F;return e.locale&&(s=e.locale.locale,u=e.locale.timeZone,F=e.formats),t.length===1?y(e,t[0],F):t.length?y(e,...t):e.toLocaleString(s||[],u?{timeZone:u}:void 0)},b=(e,t)=>h(t)&&o(t).forEach(([s,u])=>e[`set${s}`](u))&&!0||!1,w=e=>[e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()??0],N=e=>[e.getFullYear(),e.getMonth()+1,e.getDate()],P=(e,t)=>b(e,t)||w(e),W=(e,t)=>b(e,t)||N(e),H=J(),j=(e,t)=>c(new Date(e,t+1,1,0,0,0)).yesterday.getDate(),V=e=>[e.getFullYear(),e.getMonth(),e.getDate()],L=e=>c(new Date(e)).relocate(e.localeInfo),U=Q(),M=(e,...t)=>c(U(e,...t)),z=(e,t)=>[`${e&&!(Array.isArray(e)&&e.length<1)?`l:${e}`:""}`,`${t?`tz:${t}`:""}`].filter(s=>s).join(","),E=function(e,{locale:t,timeZone:s}={}){if(t||s){let u=p(t||[],s);e.localeInfo={locale:u?.locale||navigator?.language||"en",timeZone:u?.timeZone||Intl.DateTimeFormat().resolvedOptions().timeZone},e.formats=z(e.localeInfo.locale,e.localeInfo.timeZone)}return e.localeInfo??void 0},Y=(e,{locale:t,timeZone:s,validate:u=!0}={})=>((t||s)&&(e.localeInfo=E(e,{locale:t,timeZone:s,validate:u})),e.localeInfo),X=e=>(delete e.localeInfo,c(e)),k=function(e,t,s,u){return(t||s)&&Y(e,{locale:t,timeZone:s}),c(e)},A=function(e,t){return e=c(e),e.format(t?"MM":"WD",`l:${e.locale?.locale||"utc"}`)},G=e=>{let t={};if(e=c(e),!e.locale)return e.toLocaleDateString();let{locale:s,timeZone:u}=e.locale;return e.locale?.timeZone&&(t={timeZone:e.locale.timeZone}),e.toLocaleDateString(s,t)},_=(e,t)=>{let s=w(e).reduce((u,F,O)=>[...u,O<3?D(F):D(F,3)],[]);return`${s.slice(0,3).join(":")}${t?`.${s.slice(-1)}`:""}`},q=e=>{let t=S(e),s=new Date(e.getFullYear(),0,1,14),u=new Date(new Date(s).setMonth(6)),F=Intl.DateTimeFormat("en-CA",{year:"numeric",timeZone:t,timeZoneName:"shortOffset"}),[O,Z]=[F.format(s),F.format(u)];return l(O)-l(Z)!==0};function x(e,t){let s=0;for(e=c(e),t=c(t),e.time=t.time={hour:0,minutes:0,seconds:0,milliseconds:0},e>t&&([e,t]=[t,e]);e<nexDate;)e.add("1 day"),s+=1;return s}return{clone:L,localizedDT:i,hasDST:q,getTimezone:S,dateStr:G,locale2Formats:e=>z(e.localeInfo?.locale,e.localeInfo?.timeZone),year:(e,t)=>t&&e.setFullYear(t)||e.getFullYear(),month:(e,t)=>t&&e.setMonth(v-1)||e.getMonth()+1,date:(e,{year:t,month:s,date:u}={})=>W(e,{FullYear:t,Month:d(s)?s-1:s,Date:u}),hour:(e,t)=>t&&e.setHours(t)||e.getHours(),minutes:(e,t)=>t&&e.setMinutes(t)||e.getMinutes(),seconds:(e,t)=>t&&e.setSeconds(t)||e.getSeconds(),cloneTimeTo:e=>t=>T(e,t),cloneDateTo:e=>t=>g(e,t),time:(e,{hour:t,minutes:s,seconds:u,milliseconds:F}={})=>P(e,{Hours:t,Minutes:s,Seconds:u,Milliseconds:F}),timeStr:e=>(t=!1)=>_(e,t),dateISOStr:e=>r(e),ms:(e,t)=>t&&e.setMilliseconds(t)||e.getMilliseconds(),monthName:e=>A(e,!0),weekDay:e=>A(e),self:e=>e,local:e=>I(e),locale:(e,{locale:t,timeZone:s}={})=>Y(e,{locale:t,timeZone:s}),removeLocale:e=>X(e),relocate:e=>({locale:t,timeZone:s}={})=>k(e,t,s),differenceFrom:e=>t=>H({start:e,end:t}),values:e=>(t=!1)=>a(e,t),ISO:e=>e.toISOString(),daysInMonth:e=>j(e.getFullYear(),e.getMonth()),isLeapYear:e=>j(e.getFullYear(),1)===29,format:e=>(...t)=>$(e,...t),daysUntil:e=>t=>x(e,t),addYears:e=>(t=1)=>M(e,`${t} years`),addMonths:e=>(t=1)=>M(e,`${t} months`),addWeeks:e=>(t=1)=>M(e,`${t*7} days`),addDays:e=>(t=1)=>M(e,`${t} days`),nextYear:e=>M(e,"1 year"),nextWeek:e=>M(e,"7 days"),previousWeek:e=>M(e,"subtract, 7 days"),previousYear:e=>M(e,"subtract, 1 year"),nextMonth:e=>M(e,"1 month"),previousMonth:e=>M(e,"subtract, 1 month"),tomorrow:e=>M(e,"1 day"),yesterday:e=>M(e,"subtract, 1 day"),add:e=>(...t)=>M(e,...t),subtract:e=>(...t)=>M(e,...["subtract"].concat([t]).flat())}}function B(){let[c,p,m,y]=["2-digit","numeric","long","short"],d={fixed:{MM:{month:m},M:{month:y},m:{month:p},mm:{month:c},yyyy:{year:p},yy:{year:c},WD:{weekday:m},wd:{weekday:y},d:{day:p},dd:{day:c},h:{hour:p},hh:{hour:c},mi:{minute:p},mmi:{minute:c},s:{second:p},ss:{second:c},ms:{fractionalSecondDigits:3},tz:{timeZoneName:"shortOffset"},dl:{locale:"default"},h12:{hour12:!1},yn:{yearName:""},ry:{relatedYear:!0},msp:{fractionalSecond:!0}},dynamic:{tzn:o=>({timeZoneName:o.slice(4)}),hrc:o=>({hourCycle:`h${o.slice(4)}`}),ds:o=>({dateStyle:o.slice(3)}),ts:o=>({timeStyle:o.slice(3)}),tz:o=>({timeZone:o.slice(3)}),e:o=>({era:o.slice(2)}),l:o=>({locale:o.slice(2)})}},h={...d,retrieveDyn(o){let a=o?.slice(0,o.indexOf(":"));return d.dynamic[a]&&d.dynamic[a](o)},get re(){return new RegExp(`\\b(${Object.keys(d.fixed).join("|")})\\b`,"g")}},l=(o="dtf",a=0)=>{let i=` ${o.replace(/(?<=\{)(.+?)(?=})/g,g=>`[${a++}]`).replace(/[{}]/g,"").trim()} `,f=o.match(/(?<=\{)(.+?)(?=})/g)||[];return{get texts(){return f},formatString(g){i=g},set formatStr(g){i=g},get formatStr(){return i},get units(){return i.match(h.re)||[]},finalize(g="",T="",I="",$=""){return i.replace(/~([\d+]?)/g,"$1").replace(/dtf/,g).replace(/era/,I).replace(/dp\b|~dp\b/,T).replace(/yn\b/,$).replace(/\[(\d+?)]/g,(b,w)=>f[w].trim()).trim()}}},S=o=>o.replace(/\s+/g,""),D=(...o)=>o?.reduce((a,i)=>({...a,...h.retrieveDyn(i)||h.fixed[i]}),h.fixed.dl),n=(o,a,i)=>{let f=D(...S(i).split(",")),g=Intl.DateTimeFormat(f.locale,f).format(o);return a.finalize(g)},r=(o,a,i)=>{let f=D(...a.units.concat(S(i).split(",")).flat()),g={...h.fixed},T=($,b)=>f[$]==="numeric"&&b.startsWith("0")?b.slice(1):b,I=Intl.DateTimeFormat(f.locale,f).formatToParts(o).reduce(($,b)=>b.type==="literal"?$:{...$,[b.type]:T(b.type,b.value)},{});return g.ms=f.fractionalSecondDigits?g.msp:g.ms,g.yyyy=I.relatedYear?g.ry:g.yyyy,a.formatStr=a.formatStr.replace(h.re,$=>I[Object.keys(g[$]).shift()]||$),a.finalize(void 0,I.dayPeriod,I.era,I.yearName)};return(o,a,i="l:default")=>/ds:|ts:/.test(i)?n(o,l(void 0),i):r(o,l(a||void 0),i)}function J(){let c=(y,d)=>{let h=isNaN(y),l=isNaN(d);if(h&&!l){let[S,D,n]=Array(3).fill("start- and/or end date are not valid");return{error:!0,message:S,full:D,clean:n}}if(l){let[S,D,n]=Array(3).fill("end date not valid");return{error:!0,message:S,full:D,clean:n}}if(h){let[S,D,n]=Array(3).fill("start date not valid");return{error:!0,message:S,full:D,clean:n}}return{error:!1}},p=m();return function({start:d,end:h}={}){let l=new Date(Date.parse(d)),S=new Date(Date.parse(h)),D=c(l,S);if(D.error)return D;let n=new Date(d),r=new Date(h),o=Math.abs(r-n),a=new Date(o),i=a.getUTCFullYear()-1970,f=a.getUTCMonth(),g=a.getUTCDate()-1,T=a.getUTCHours(),I=a.getUTCMinutes(),$=a.getUTCSeconds(),b=a.getUTCMilliseconds(),w={from:n,to:r,years:i,months:f,days:g,hours:T,minutes:I,seconds:$,milliseconds:b};return w.full=p({values:w,full:!0}),w.clean=p({values:w}),w};function m(){let y=(...n)=>r=>n.reduce((o,a)=>a(o),r),d=(n,r)=>n===1?r.slice(0,-1):r;return y(({values:n,full:r})=>[Object.entries(n).filter(([o])=>/^(years|month|days|hours|minutes|seconds)/i.test(o)),r],([n,r])=>r?n:n.filter(([,o])=>r?+o:o>0),n=>n.reduce((r,[o,a])=>[...r,`${a} ${d(a,o)}`],[]),n=>n.length<1?"Dates are equal":`${n.slice(0,-1).join(", ")}${n.length>1?" and ":""}${n.slice(-1).shift()}`)}}function Q(){let c=Object.entries({year:"FullYear",month:"Month",date:"Date",day:"Date",hour:"Hours",minute:"Minutes",second:"Seconds",millisecond:"Milliseconds"}).reduce((m,[y,d])=>({...m,[y]:d,[`${y}s`]:d}),{}),p=function(...m){if(m.length<1)return[];let y;m[0].startsWith("subtract")&&(y=!0,m[0].startsWith("subtract")&&m.length===1&&(m=m[0].split(",")),m=m.slice(1));let d=m.length===1?m[0]?.split(/,/):m;return d&&d.length&&(m=d.map(h=>h.trim())),m.map(function(h){return h.toLowerCase().split(/\s/).map(l=>(l=l.trim(),parseInt(l)?y?-l:+l:l))})};return function(m,...y){let d=p(...y);return d.length&&d.forEach(([h,l])=>{l=c[l],+h&&l&&m[`set${l}`](m[`get${l}`]()+ +h)}),m}}
